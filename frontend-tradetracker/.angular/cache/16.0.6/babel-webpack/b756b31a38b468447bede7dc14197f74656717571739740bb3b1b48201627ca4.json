{"ast":null,"code":"import { BehaviorSubject, combineLatest, map, of } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"./account.service\";\nimport * as i2 from \"./transaction.service\";\nclass AnalyticsService {\n  constructor(accountService, transactionService) {\n    this.accountService = accountService;\n    this.transactionService = transactionService;\n    // Default exchange rate, should be updated from settings\n    this.exchangeRate = {\n      EUR_TO_USD: 1.1,\n      USD_TO_EUR: 0.91\n    };\n    // Observable to track exchange rate changes\n    this.exchangeRateSubject = new BehaviorSubject(this.exchangeRate);\n    // Données mockées pour les performances des comptes\n    this.mockPerformanceData = {\n      '1': 83.0,\n      '2': 87.5,\n      '3': 64.0,\n      '4': 85.8,\n      '5': 78.2 // 7820.45 / 10000 * 100\n    };\n    // Données mockées pour les suggestions de retrait\n    this.mockWithdrawalSuggestions = {\n      '1': 0,\n      '2': 0,\n      '3': 0,\n      '4': 0,\n      '5': 0 // Sous le seuil\n    };\n    // Données mockées pour les profits/pertes\n    this.mockProfitLossData = {\n      '1': 4450.75,\n      '2': 2250.50,\n      '3': 200.25,\n      '4': 650.80,\n      '5': 1820.45 // 7820.45 + 0 - 6000\n    };\n    // Données mockées pour le ROI\n    this.mockROIData = {\n      '1': 44.51,\n      '2': 30.01,\n      '3': 6.68,\n      '4': 13.02,\n      '5': 30.34 // (7820.45 + 0 - 6000) / 6000 * 100\n    };\n  }\n\n  setExchangeRates(eurToUsd, usdToEur) {\n    this.exchangeRate = {\n      EUR_TO_USD: eurToUsd,\n      USD_TO_EUR: usdToEur\n    };\n    this.exchangeRateSubject.next(this.exchangeRate);\n  }\n  getExchangeRates() {\n    return this.exchangeRateSubject.asObservable();\n  }\n  getAccountPerformance(accountId) {\n    // Utiliser les données mockées pour une réponse plus rapide\n    if (this.mockPerformanceData[accountId]) {\n      return of(this.mockPerformanceData[accountId]);\n    }\n    // Sinon, calculer normalement\n    return this.accountService.getAccountById(accountId).pipe(map(account => {\n      if (!account) return 0;\n      return account.targetBalance > 0 ? account.currentBalance / account.targetBalance * 100 : 0;\n    }));\n  }\n  getWithdrawalSuggestions(accountId) {\n    // Utiliser les données mockées pour une réponse plus rapide\n    if (this.mockWithdrawalSuggestions[accountId] !== undefined) {\n      return of(this.mockWithdrawalSuggestions[accountId]);\n    }\n    // Sinon, calculer normalement\n    return this.accountService.getAccountById(accountId).pipe(map(account => {\n      if (!account || account.currentBalance <= account.withdrawalThreshold) return 0;\n      // Suggest withdrawing anything above the threshold\n      return account.currentBalance - account.withdrawalThreshold;\n    }));\n  }\n  getAccountsAboveThreshold() {\n    return this.accountService.getAccounts().pipe(map(accounts => accounts.filter(account => account.currentBalance >= account.withdrawalThreshold)));\n  }\n  getTotalBalanceInCurrency(targetCurrency) {\n    return this.accountService.getAccounts().pipe(map(accounts => {\n      return accounts.reduce((total, account) => {\n        let balance = account.currentBalance;\n        // Convert if currencies don't match\n        if (account.currency !== targetCurrency) {\n          balance = this.convertCurrency(balance, account.currency, targetCurrency);\n        }\n        return total + balance;\n      }, 0);\n    }));\n  }\n  convertCurrency(amount, fromCurrency, toCurrency) {\n    if (fromCurrency === toCurrency) return amount;\n    if (fromCurrency === 'EUR' && toCurrency === 'USD') {\n      return amount * this.exchangeRate.EUR_TO_USD;\n    } else {\n      return amount * this.exchangeRate.USD_TO_EUR;\n    }\n  }\n  getAccountProfitLoss(accountId) {\n    // Utiliser les données mockées pour une réponse plus rapide\n    if (this.mockProfitLossData[accountId] !== undefined) {\n      return of(this.mockProfitLossData[accountId]);\n    }\n    // Sinon, calculer normalement\n    return combineLatest([this.accountService.getAccountById(accountId), this.transactionService.getTotalDepositsByAccount(accountId), this.transactionService.getTotalWithdrawalsByAccount(accountId)]).pipe(map(([account, totalDeposits, totalWithdrawals]) => {\n      if (!account) return 0;\n      // Profit/Loss = Current Balance + Total Withdrawals - Total Deposits\n      return account.currentBalance + totalWithdrawals - totalDeposits;\n    }));\n  }\n  getAccountROI(accountId) {\n    // Utiliser les données mockées pour une réponse plus rapide\n    if (this.mockROIData[accountId] !== undefined) {\n      return of(this.mockROIData[accountId]);\n    }\n    // Sinon, calculer normalement\n    return combineLatest([this.accountService.getAccountById(accountId), this.transactionService.getTotalDepositsByAccount(accountId), this.transactionService.getTotalWithdrawalsByAccount(accountId)]).pipe(map(([account, totalDeposits, totalWithdrawals]) => {\n      if (!account || totalDeposits === 0) return 0;\n      // ROI = (Current Balance + Total Withdrawals - Total Deposits) / Total Deposits * 100\n      const profitLoss = account.currentBalance + totalWithdrawals - totalDeposits;\n      return profitLoss / totalDeposits * 100;\n    }));\n  }\n  static {\n    this.ɵfac = function AnalyticsService_Factory(t) {\n      return new (t || AnalyticsService)(i0.ɵɵinject(i1.AccountService), i0.ɵɵinject(i2.TransactionService));\n    };\n  }\n  static {\n    this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n      token: AnalyticsService,\n      factory: AnalyticsService.ɵfac,\n      providedIn: 'root'\n    });\n  }\n}\nexport { AnalyticsService };","map":{"version":3,"names":["BehaviorSubject","combineLatest","map","of","AnalyticsService","constructor","accountService","transactionService","exchangeRate","EUR_TO_USD","USD_TO_EUR","exchangeRateSubject","mockPerformanceData","mockWithdrawalSuggestions","mockProfitLossData","mockROIData","setExchangeRates","eurToUsd","usdToEur","next","getExchangeRates","asObservable","getAccountPerformance","accountId","getAccountById","pipe","account","targetBalance","currentBalance","getWithdrawalSuggestions","undefined","withdrawalThreshold","getAccountsAboveThreshold","getAccounts","accounts","filter","getTotalBalanceInCurrency","targetCurrency","reduce","total","balance","currency","convertCurrency","amount","fromCurrency","toCurrency","getAccountProfitLoss","getTotalDepositsByAccount","getTotalWithdrawalsByAccount","totalDeposits","totalWithdrawals","getAccountROI","profitLoss","i0","ɵɵinject","i1","AccountService","i2","TransactionService","factory","ɵfac","providedIn"],"sources":["/home/vagrant/workspace/windsurf/tradetracker/frontend-tradetracker/src/app/services/analytics.service.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\nimport { Observable, BehaviorSubject, combineLatest, map, of } from 'rxjs';\nimport { Account, Currency } from '../models/account.model';\nimport { AccountService } from './account.service';\nimport { TransactionService } from './transaction.service';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class AnalyticsService {\n  // Default exchange rate, should be updated from settings\n  private exchangeRate = { EUR_TO_USD: 1.1, USD_TO_EUR: 0.91 };\n  \n  // Observable to track exchange rate changes\n  private exchangeRateSubject = new BehaviorSubject<{ EUR_TO_USD: number, USD_TO_EUR: number }>(this.exchangeRate);\n  \n  // Données mockées pour les performances des comptes\n  private mockPerformanceData: { [accountId: string]: number } = {\n    '1': 83.0, // 12450.75 / 15000 * 100\n    '2': 87.5, // 8750.50 / 10000 * 100\n    '3': 64.0, // 3200.25 / 5000 * 100\n    '4': 85.8, // 5150.80 / 6000 * 100\n    '5': 78.2  // 7820.45 / 10000 * 100\n  };\n  \n  // Données mockées pour les suggestions de retrait\n  private mockWithdrawalSuggestions: { [accountId: string]: number } = {\n    '1': 0,     // Sous le seuil\n    '2': 0,     // Sous le seuil\n    '3': 0,     // Sous le seuil\n    '4': 0,     // Sous le seuil\n    '5': 0      // Sous le seuil\n  };\n  \n  // Données mockées pour les profits/pertes\n  private mockProfitLossData: { [accountId: string]: number } = {\n    '1': 4450.75,  // 12450.75 + 2000 - 10000\n    '2': 2250.50,  // 8750.50 + 1000 - 7500\n    '3': 200.25,   // 3200.25 + 0 - 3000\n    '4': 650.80,   // 5150.80 + 500 - 5000\n    '5': 1820.45   // 7820.45 + 0 - 6000\n  };\n  \n  // Données mockées pour le ROI\n  private mockROIData: { [accountId: string]: number } = {\n    '1': 44.51,  // (12450.75 + 2000 - 10000) / 10000 * 100\n    '2': 30.01,  // (8750.50 + 1000 - 7500) / 7500 * 100\n    '3': 6.68,   // (3200.25 + 0 - 3000) / 3000 * 100\n    '4': 13.02,  // (5150.80 + 500 - 5000) / 5000 * 100\n    '5': 30.34   // (7820.45 + 0 - 6000) / 6000 * 100\n  };\n\n  constructor(\n    private accountService: AccountService,\n    private transactionService: TransactionService\n  ) {}\n\n  setExchangeRates(eurToUsd: number, usdToEur: number): void {\n    this.exchangeRate = { EUR_TO_USD: eurToUsd, USD_TO_EUR: usdToEur };\n    this.exchangeRateSubject.next(this.exchangeRate);\n  }\n  \n  getExchangeRates(): Observable<{ EUR_TO_USD: number, USD_TO_EUR: number }> {\n    return this.exchangeRateSubject.asObservable();\n  }\n\n  getAccountPerformance(accountId: string): Observable<number> {\n    // Utiliser les données mockées pour une réponse plus rapide\n    if (this.mockPerformanceData[accountId]) {\n      return of(this.mockPerformanceData[accountId]);\n    }\n    \n    // Sinon, calculer normalement\n    return this.accountService.getAccountById(accountId).pipe(\n      map(account => {\n        if (!account) return 0;\n        return account.targetBalance > 0 \n          ? (account.currentBalance / account.targetBalance) * 100 \n          : 0;\n      })\n    );\n  }\n\n  getWithdrawalSuggestions(accountId: string): Observable<number> {\n    // Utiliser les données mockées pour une réponse plus rapide\n    if (this.mockWithdrawalSuggestions[accountId] !== undefined) {\n      return of(this.mockWithdrawalSuggestions[accountId]);\n    }\n    \n    // Sinon, calculer normalement\n    return this.accountService.getAccountById(accountId).pipe(\n      map(account => {\n        if (!account || account.currentBalance <= account.withdrawalThreshold) return 0;\n        // Suggest withdrawing anything above the threshold\n        return account.currentBalance - account.withdrawalThreshold;\n      })\n    );\n  }\n\n  getAccountsAboveThreshold(): Observable<Account[]> {\n    return this.accountService.getAccounts().pipe(\n      map(accounts => accounts.filter(account => \n        account.currentBalance >= account.withdrawalThreshold\n      ))\n    );\n  }\n\n  getTotalBalanceInCurrency(targetCurrency: Currency): Observable<number> {\n    return this.accountService.getAccounts().pipe(\n      map(accounts => {\n        return accounts.reduce((total, account) => {\n          let balance = account.currentBalance;\n          \n          // Convert if currencies don't match\n          if (account.currency !== targetCurrency) {\n            balance = this.convertCurrency(\n              balance, \n              account.currency, \n              targetCurrency\n            );\n          }\n          \n          return total + balance;\n        }, 0);\n      })\n    );\n  }\n\n  private convertCurrency(\n    amount: number, \n    fromCurrency: Currency, \n    toCurrency: Currency\n  ): number {\n    if (fromCurrency === toCurrency) return amount;\n    \n    if (fromCurrency === 'EUR' && toCurrency === 'USD') {\n      return amount * this.exchangeRate.EUR_TO_USD;\n    } else {\n      return amount * this.exchangeRate.USD_TO_EUR;\n    }\n  }\n\n  getAccountProfitLoss(accountId: string): Observable<number> {\n    // Utiliser les données mockées pour une réponse plus rapide\n    if (this.mockProfitLossData[accountId] !== undefined) {\n      return of(this.mockProfitLossData[accountId]);\n    }\n    \n    // Sinon, calculer normalement\n    return combineLatest([\n      this.accountService.getAccountById(accountId),\n      this.transactionService.getTotalDepositsByAccount(accountId),\n      this.transactionService.getTotalWithdrawalsByAccount(accountId)\n    ]).pipe(\n      map(([account, totalDeposits, totalWithdrawals]) => {\n        if (!account) return 0;\n        // Profit/Loss = Current Balance + Total Withdrawals - Total Deposits\n        return account.currentBalance + totalWithdrawals - totalDeposits;\n      })\n    );\n  }\n\n  getAccountROI(accountId: string): Observable<number> {\n    // Utiliser les données mockées pour une réponse plus rapide\n    if (this.mockROIData[accountId] !== undefined) {\n      return of(this.mockROIData[accountId]);\n    }\n    \n    // Sinon, calculer normalement\n    return combineLatest([\n      this.accountService.getAccountById(accountId),\n      this.transactionService.getTotalDepositsByAccount(accountId),\n      this.transactionService.getTotalWithdrawalsByAccount(accountId)\n    ]).pipe(\n      map(([account, totalDeposits, totalWithdrawals]) => {\n        if (!account || totalDeposits === 0) return 0;\n        // ROI = (Current Balance + Total Withdrawals - Total Deposits) / Total Deposits * 100\n        const profitLoss = account.currentBalance + totalWithdrawals - totalDeposits;\n        return (profitLoss / totalDeposits) * 100;\n      })\n    );\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}